---
import Icon from './components/Icon.astro';
import { Image as AstroImage } from 'astro:assets';
import { renderRichText } from '@storyblok/astro';
import Image from './components/Image.astro';
import ProjectList from './components/ProjectList.astro';
import ContactLink from './components/ContactLink.astro';
const { blok, projects } = Astro.props;

function renderContent(content) {
  return content ? renderRichText(content) : '';
}
---

<div class="relative h-screen pt-[160px] min-h-[480px]">
  {blok.heroText && <p class="relative z-10 text-4xl uppercase text-white font-functionpro">{blok.heroText}</p>}

  {blok.featureImages && blok.featureImages.length > 0 && (
    <AstroImage
      src={blok.featureImages[0].filename}
      alt={blok.featureImages[0].title || ''}
      inferSize={true}
      class="absolute top-0 left-0 z-0 h-full w-full object-cover"
    />
  )}
</div>

<div>
  {blok.aboutText && <section id="about" class="bg-tiled-gradient" set:html={renderContent(blok.aboutText)} />}

  <section id="projects">
    <h2>Projects</h2>

    {projects && (
      <ProjectList projects={projects} />
    )}
  </section>

  {blok.featureImages && blok.featureImages.length > 1 && (
    <Image image={blok.featureImages[blok.featureImages.length - 1]} wrapperClass="w-1/2" />
  )}

  {blok.processText && <section id="process" class="bg-tiled-gradient" set:html={renderContent(blok.processText)} />}

  {blok.culturePhotos && blok.culturePhotos.map((image) => (
    <Image image={image} wrapperClass="w-1/2" />
  ))}

  {blok.processPhotos && blok.processPhotos.map((image) => (
    <Image image={image} wrapperClass="w-1/2" />
  ))}

  <section class="grid grid-cols-6">
    {blok.generalPhotos && blok.generalPhotos.slice(0, 6).map((image) => (
      <Image image={image} wrapperClass="col-span-3 lg:col-span-1" />
    ))}
  </section>

  <section class="py-[60px]">
    <h2 class="flex flex-col items-center gap-4 font-functionpro text-mud">
      <Icon icon="faq" />
      <abbr class="no-underline" title="Frequently Asked Questions">FAQ</abbr>
    </h2>

    <ul class="max-w-7xl mx-auto mt-[50px]">
      {blok.faq && blok.faq.map((item, index) => (
        <li
          x-data={`{ expanded: ${index === 0} }`}
          x-id="['faq-question', 'faq-answer']"
          class="mb-11 px-3"
        >
          {item.question && (
            <h3 class="pl-10 relative">
              <span class="absolute top-0 left-0 block h-6 w-6 rounded-full transition-colors duration-300" :class="expanded ? 'bg-red' : 'bg-green'"><i class="absolute top-1/2 left-1/2 block w-3 -translate-x-1/2 -translate-y-1/2 bg-white h-[2px]"></i><i class="absolute top-1/2 left-1/2 block w-3 -translate-x-1/2 -translate-y-1/2 bg-white transition-transform duration-300 h-[2px]" :class="expanded ? 'rotate-0' : '-rotate-90'"></i></span>

              <button
                @click="expanded = !expanded"
                :aria-expanded="expanded"
                :aria-controls="$id('faq-answer')"
                :id="$id('faq-question')"
                class="text-base uppercase font-functionpro text-green leading-6"
              >
                {item.question}
              </button>
            </h3>
          )}
          {item.answer && (
            <div
              :id="$id('faq-answer')"
              :aria-labelledby="$id('faq-question')"
              set:html={renderContent(item.answer)}
              x-show="expanded"
              x-collapse
              class="px-10 leading-7"
            />
          )}
        </li>
      ))}
    </ul>
  </section>

  <section id="contact" class="md:flex bg-tiled">
    {blok.contactUs && (
      <ContactLink
        href="https://www.viget.com/contact/"
        icon="contact"
        title="Contact Us"
        content={blok.contactUs}
      />
    )}

    {blok.hireViget && (
      <ContactLink
        href="https://www.viget.com/contact/"
        icon="hire"
        title="Hire Viget"
        content={blok.hireViget}
      />
    )}

    {blok.joinViget && (
      <ContactLink
        href="https://www.viget.com/careers"
        icon="join"
        title="Join Viget"
        content={blok.joinViget}
      />
    )}
  </section>
</div>
